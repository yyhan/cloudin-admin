<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cloudin.admin.dao.AuthDao">
    <resultMap id="BaseResultMap" type="com.cloudin.admin.entity.Permission">
        <id column="id" jdbcType="INTEGER" property="id" />
        <result column="name" jdbcType="VARCHAR" property="name" />
        <result column="content" jdbcType="VARCHAR" property="content" />
        <result column="icon" jdbcType="VARCHAR" property="icon" />
        <result column="category" jdbcType="INTEGER" property="category" />
        <result column="order" jdbcType="INTEGER" property="order" />
        <result column="parent_id" jdbcType="INTEGER" property="parentId" />
        <result column="ext_info" jdbcType="VARCHAR" property="extInfo" />
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
        <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
        <result column="is_valid" jdbcType="TINYINT" property="valid" />
    </resultMap>
    <select id="listRoles" resultType="java.lang.String">
        SELECT B.`code`
        FROM administrator_role A
        LEFT JOIN role B ON A.role_id = B.id
        WHERE A.administrator_id = #{administratorId} AND A.is_valid = 1 AND  B.is_valid = 1
    </select>
    <select id="listPermission" resultMap="BaseResultMap">
        SELECT D.`id`, D.`name`, D.`content`, D.`icon`, D.`category`, D.`order`, D.`parent_id`, D.`ext_info`,
        D.`create_time`, D.`update_time`, D.`is_valid`
        FROM administrator_role A
        LEFT JOIN role B ON A.role_id = B.id
        LEFT JOIN role_permission C ON A.role_id = C.role_id
        LEFT JOIN permission D ON C.permission_id = D.id
        WHERE A.administrator_id = #{administratorId} AND A.is_valid = 1 AND  B.is_valid = 1 AND  C.is_valid = 1
        AND  D.is_valid = 1
    </select>
    <select id="listPermissionRoleMap" resultType="java.util.Map">
        SELECT A.id permissionId, A.content, C.id roleId, C.code
        FROM permission A
        LEFT JOIN role_permission B ON A.id = B.permission_id
        LEFT JOIN role C ON B.role_id = C.id
        WHERE A.is_valid = 1 AND  B.is_valid = 1 AND  C.is_valid = 1
    </select>
</mapper>

